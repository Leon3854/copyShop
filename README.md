# Техническое задание: Микросервис аутентификации (auth-service)
## 1. Общие сведения
### Название: Auth Service
Назначение: Централизованный сервис аутентификации и авторизации пользователей
Стек: NestJS, PostgreSQL, Prisma, TypeScript, RabbitMQ, bcrypt, passport-jwt, uuid, Jest
Статус: В разработке

## 2. Бизнес-требования
Регистрация новых пользователей
Аутентификация по email/паролю
Выдача и валидация JWT-токенов
Управление пользовательскими сессиями
Интеграция с другими сервисами через RabbitMQ
Безопасное хранение паролей

## 3. Функциональные требования
### 3.1. Модуль пользователей (User Module)
Создание пользователя с полями: email, password, name, id (uuid)
Валидация уникальности email
Хеширование пароля с использованием bcrypt
Получение профиля пользователя
Обновление профиля (кроме email)
Мягкое удаление пользователя

### 3.2. Модуль аутентификации (Auth Module)
Эндпоинт /auth/register (POST)
Эндпоинт /auth/login (POST) → возвращает JWT
Эндпоинт /auth/logout (POST) → инвалидация токена
Эндпоинт /auth/refresh (POST) → обновление access token
Генерация Access Token (короткоживущий) и Refresh Token
Валидация JWT через passport-jwt стратегию

### 3.3. Модуль событий (Event Module)
Отправка событий через RabbitMQ:
user.created
user.updated
user.deleted
user.logged_in
Конфигурируемые очереди и exchange
Retry логика для обработки ошибок отправки

## 4. Нефункциональные требования
### 4.1. Производительность
Время ответа API < 200 мс (p95)
Поддержка до 1000 RPS на инстанс
Кэширование частых запросов (задел на будущее)

### 4.2. Безопасность
Пароли хешируются с salt (bcrypt, cost factor 12)
JWT секрет хранится в environment variables
Access Token TTL: 15 минут
Refresh Token TTL: 7 дней (хранится в БД)
Защита от brute-force (лимит попыток входа)
Валидация входных данных (DTO)

### 4.3. Надежность
Транзакционность операций (Prisma)
Обработка ошибок с понятными кодами
Логирование ключевых событий и ошибок
Health-check эндпоинт

## 5. Структура проекта

